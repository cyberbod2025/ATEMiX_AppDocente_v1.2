<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AtemiMX ‚Äî App Docente</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- SPLASH SCREEN -->
  <div id="splash-screen" aria-label="Bienvenida" role="status">
    <img src="assets/atemi-iso.svg" alt="ISO AtemiMX" class="splash-iso" />
    <h1 class="splash-title">AtemiMX ‚Äî App Docente</h1>
    <p class="splash-sub">Planifica ¬∑ Inspira ¬∑ Ense√±a</p>
  </div>

  <!-- APP PRINCIPAL -->
  <div id="main-app" class="hidden">
    <header id="app-header">
      <div class="brand" style="display:flex;align-items:center;gap:10px">
        <img src="assets/atemi-iso.svg" alt="ISO" style="width:34px;height:34px;border-radius:50%;object-fit:contain;background:#ffffff1a">
        <span style="font-weight:700;letter-spacing:.3px">AtemiMX</span>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" id="btn-reset">Reiniciar Onboarding</button>
      </div>
    </header>

    <aside id="app-sidebar">
      <nav>
        <ul>
          <li><a href="#" data-view="onboarding">üöÄ Onboarding</a></li>
          <li><a href="#" data-view="catalogo">üìö Cat√°logo NEM</a></li>
          <li><a href="#" data-view="planeacion">üìñ Planeaci√≥n</a></li>
          <li><a href="#" data-view="gradebook">üìù Calificaciones</a></li>
          <li><a href="#" data-view="seating">üé≤ Asientos</a></li>
        </ul>
      </nav>
    </aside>

    <main id="app-content">
      <!-- VISTA ONBOARDING -->
      <div id="view-onboarding" class="content-view card">
        <h2>Configuraci√≥n Inicial</h2>
        <p style="opacity: 0.7; margin-bottom: 1.5rem;">Completa tus datos para personalizar la experiencia.</p>
        <div class="row" style="margin-bottom: 1rem;">
          <div><label for="docente">Nombre del Docente</label><input id="docente" placeholder="Ej. Hugo S√°nchez" class="input-field" /></div>
          <div><label for="escuela">Escuela</label><input id="escuela" placeholder="Ej. Secundaria T√©cnica 310" class="input-field" /></div>
        </div>
        <div class="row" style="margin-bottom: 1rem;">
          <div><label for="ciclo">Ciclo Escolar</label><input id="ciclo" placeholder="2025-2026" class="input-field" /></div>
          <div><label for="fase">Fase</label><input id="fase" type="number" min="2" max="6" placeholder="Ej. 6" class="input-field" /></div>
        </div>
        <div class="row" style="margin-bottom: 1rem;">
          <div><label for="grados">Grados (separados por coma)</label><input id="grados" placeholder="1, 2, 3" class="input-field" /></div>
          <div><label for="grupos">Grupos (separados por coma)</label><input id="grupos" placeholder="1A, 1B, 2C" class="input-field" /></div>
        </div>
        <div class="row" style="margin-bottom: 1.5rem;">
          <div><label for="campos">Campos Formativos (separados por coma)</label><input id="campos" placeholder="Saberes y Pensamiento Cient√≠fico" class="input-field" /></div>
          <div><label for="ejes">Ejes Articuladores (separados por coma)</label><input id="ejes" placeholder="Inclusi√≥n, Pensamiento cr√≠tico" class="input-field" /></div>
        </div>
        <input id="estilo" type="hidden" />
        <button id="btnGuardarOnboarding" class="btn btn-primary">Guardar y Continuar</button>
      </div>

      <!-- VISTA CAT√ÅLOGO -->
      <div id="view-catalogo" class="content-view card hidden">
        <h2>Cat√°logo de Contenidos (NEM)</h2>
        <div class="row" style="margin-bottom: 1rem;">
          <div><label for="cat-fase">Fase</label><select id="cat-fase" class="select-field"></select></div>
          <div><label for="cat-campo">Campo Formativo</label><select id="cat-campo" class="select-field"></select></div>
          <div><label for="cat-grado">Grado</label><select id="cat-grado" class="select-field"></select></div>
        </div>
        <ol id="cat-lista"></ol>
        <button id="cat-add" class="btn btn-primary" style="margin-top:1rem">A√±adir a Planeaci√≥n</button>
        <p style="font-size:12px;color:#cbd5e1;margin-top:1rem;opacity:0.7;">Tip: haz clic en los contenidos para seleccionarlos.</p>
      </div>

      <!-- VISTA PLANEACI√ìN -->
      <div id="view-planeacion" class="content-view card hidden">
        <h2>Resumen de Planeaci√≥n</h2>
        <div id="plan-resumen"></div>
        <button id="plan-export" class="btn btn-secondary" style="margin-top:1rem">Exportar como JSON</button>
      </div>

      <!-- VISTA GRADEBOOK -->
      <div id="view-gradebook" class="content-view card hidden">
        <h2>Libro de Calificaciones (Gradebook)</h2>
        <p style="opacity: 0.7; margin-bottom: 1.5rem;">Pega la lista de alumnos y las tareas con su ponderaci√≥n.</p>
        <div class="row" style="margin-bottom: 1rem;">
          <div>
            <label for="alumnos">Lista de Alumnos (uno por l√≠nea)</label>
            <textarea id="alumnos" class="input-field" rows="5"></textarea>
          </div>
          <div>
            <label for="asignaturas">Tareas (formato: Tarea,peso%)</label>
            <textarea id="asignaturas" class="input-field" rows="5" placeholder="Ej. Examen,30&#10;Proyecto,25"></textarea>
          </div>
        </div>
        <button id="cargarGradebook" class="btn btn-primary">Generar Tabla</button>
        <div id="gradeActions" style="margin-top: 1rem; gap: 1rem;"></div>
        <div id="gradeTable" style="margin-top: 1.5rem; overflow-x: auto;"></div>
      </div>

      <!-- VISTA SEATING -->
      <div id="view-seating" class="content-view card hidden">
        <h2>Plano de Asientos</h2>
        <div class="row" style="margin-bottom: 1rem; align-items: flex-end;">
          <div><label for="filas">Filas</label><input id="filas" type="number" value="3" class="input-field" /></div>
          <div><label for="columnas">Columnas</label><input id="columnas" type="number" value="5" class="input-field" /></div>
          <button id="generarPlano" class="btn btn-secondary">Generar</button>
        </div>
        <div id="plano" style="display: grid; gap: 8px; margin-top: 1.5rem;"></div>
        <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
            <button id="aleatorioAsientos" class="btn btn-secondary">Asignar Aleatorio</button>
            <button id="elegirAzar" class="btn btn-primary">Elegir al Azar</button>
        </div>
      </div>
    </main>
  </div>

  <!-- L√ìGICA PRINCIPAL Y M√ìDULOS -->
  <script type="module">
    // Importar m√≥dulos
    import { initOnboarding } from './modules/onboarding.js';
    import { initCatalogo } from './modules/catalogo.js';
    import { initPlaneacion } from './modules/planeacion.js';
    import { initGradebook } from './modules/gradebook.js';
    import { initSeating } from './modules/seating.js';
    import { Storage, K } from './services/storage.js';

    // --- INICIALIZACI√ìN GENERAL ---
    function init() {
      const mainApp = document.getElementById('main-app');
      const splash = document.getElementById('splash-screen');
      
      // Ocultar splash y mostrar app
      setTimeout(() => {
        splash.classList.add('splash-hide');
        mainApp.classList.add('visible');
      }, 500);

      // L√≥gica de navegaci√≥n
      const views = document.querySelectorAll('.content-view');
      const navLinks = document.querySelectorAll('#app-sidebar nav a');
      
      function showView(viewId) {
        views.forEach(v => v.classList.toggle('hidden', v.id !== `view-${viewId}`));
        navLinks.forEach(a => a.classList.toggle('active', a.dataset.view === viewId));
        // Guardar vista actual
        Storage.set('atemix.last_view', viewId);
      }

      navLinks.forEach(a => {
        a.addEventListener('click', (e) => {
          e.preventDefault();
          showView(a.dataset.view);
        });
      });

      // Cargar √∫ltima vista o la de onboarding
      const lastView = Storage.get('atemix.last_view', 'onboarding');
      const config = Storage.get(K.CONFIG);
      showView(config ? lastView : 'onboarding');

      // Listener para cambiar de vista tras onboarding
      document.addEventListener('atemix:onboarding:ready', () => {
        showView('catalogo');
      });

      // Bot√≥n de reseteo
      document.getElementById('btn-reset')?.addEventListener('click', () => {
        if (confirm('¬øSeguro que quieres borrar tu configuraci√≥n de Onboarding?')) {
          Storage.del(K.CONFIG);
          alert('Configuraci√≥n eliminada. Por favor, completa el Onboarding de nuevo.');
          showView('onboarding');
          location.reload();
        }
      });

      // Inicializar todos los m√≥dulos de la aplicaci√≥n
      initOnboarding();
      initCatalogo();
      initPlaneacion();
    }

    // Arrancar la aplicaci√≥n
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>