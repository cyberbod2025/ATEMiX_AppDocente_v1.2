<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AtemiMX - App Docente</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- SPLASH SCREEN -->
  <div id="splash-screen" aria-label="Bienvenida" role="status">
    <img src="assets/atemi-iso.svg" alt="ISO AtemiMX" class="splash-iso" />
    <h1 class="splash-title">AtemiMX - App Docente</h1>
    <p class=\ splash-sub\>Planifica · Inspira · Enseña</p>
  </div>

  <!-- APP PRINCIPAL -->
  <div id="main-app" class="hidden">
    <header id="app-header">
      <div class="brand" style="display:flex;align-items:center;gap:10px">
        <img src="assets/atemi-iso.svg" alt="ISO" style="width:34px;height:34px;border-radius:50%;object-fit:contain;background:#ffffff1a">
        <span style="font-weight:700;letter-spacing:.3px">AtemiMX</span>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" id="btn-reset">Reiniciar Onboarding</button>
      </div>
    </header>

    <aside id="app-sidebar">
      <nav>
        <ul>
          <li><a href="#" data-view="onboarding">?? Onboarding</a></li>
          <li><a href="#" data-view="catalogo">?? Catálogo NEM</a></li>
          <li><a href="#" data-view="planeacion">?? Planeación</a></li>
          <li><a href="#" data-view="gradebook">?? Calificaciones</a></li>
          <li><a href="#" data-view="rubricas">?? Rúbricas</a></li>
          <li><a href="#" data-view="insignias">?? Insignias</a></li>
          <li><a href="#" data-view="diario">??? Diario NEM</a></li>
        </ul>
      </nav>
    </aside>

    <main id="app-content">
      <!-- VISTA ONBOARDING -->
      <div id="view-onboarding" class="content-view card">
        <h2>Configuración Inicial</h2>
        <p style="opacity: 0.7; margin-bottom: 1.5rem;">Completa tus datos para personalizar la experiencia.</p>
        <div class="row" style="margin-bottom: 1rem;">
          <div><label for="docente">Nombre del Docente</label><input id="docente" placeholder="Ej. Hugo Sánchez" class="input-field" /></div>
          <div><label for="escuela">Escuela</label><input id="escuela" placeholder="Ej. Secundaria Técnica 310" class="input-field" /></div>
        </div>
        <div class="row" style="margin-bottom: 1rem;">
          <div><label for="ciclo">Ciclo Escolar</label><input id="ciclo" placeholder="2025-2026" class="input-field" /></div>
          <div><label for="fase">Fase</label><input id="fase" type="number" min="2" max="6" placeholder="Ej. 6" class="input-field" /></div>
        </div>
        <div class="row" style="margin-bottom: 1rem;">
          <div><label for="grados">Grados (separados por coma)</label><input id="grados" placeholder="1, 2, 3" class="input-field" /></div>
          <div><label for="grupos">Grupos (separados por coma)</label><input id="grupos" placeholder="1A, 1B, 2C" class="input-field" /></div>
        </div>
        <div class="row" style="margin-bottom: 1.5rem;">
          <div><label for="campos">Campos Formativos (separados por coma)</label><input id="campos" placeholder="Saberes y Pensamiento Científico" class="input-field" /></div>
          <div><label for="ejes">Ejes Articuladores (separados por coma)</label><input id="ejes" placeholder="Inclusión, Pensamiento crítico" class="input-field" /></div>
        </div>
        <input id="estilo" type="hidden" />
        <button id="btnGuardarOnboarding" class="btn btn-primary">Guardar y Continuar</button>
      </div>

      <!-- VISTA Catálogo -->
      <div id="view-catalogo" class="content-view card hidden">
        <h2>Catálogo de Contenidos (NEM)</h2>
        <div class="row" style="margin-bottom: 1rem;">
          <div><label for="cat-fase">Fase</label><select id="cat-fase" class="select-field"></select></div>
          <div><label for="cat-campo">Campo Formativo</label><select id="cat-campo" class="select-field"></select></div>
          <div><label for="cat-grado">Grado</label><select id="cat-grado" class="select-field"></select></div>
        </div>
        <ol id="cat-lista"></ol>
        <button id="cat-add" class="btn btn-primary" style="margin-top:1rem">Añadir a Planeación</button>
        <p style="font-size:12px;color:#cbd5e1;margin-top:1rem;opacity:0.7;">Tip: haz clic en los contenidos para seleccionarlos.</p>
      </div>

      <!-- VISTA Planeación -->
      <div id="view-planeacion" class="content-view card hidden">
        <h2>Resumen de Planeación</h2>
        <div id="plan-resumen"></div>
        <button id="plan-export" class="btn btn-secondary" style="margin-top:1rem">Exportar como JSON</button>
      </div>

      <!-- GRADEBOOK -->
      <div id="view-gradebook" class="content-view card hidden">
        <h2>Libro de Calificaciones (Mi Progreso NEM)</h2>
        <div class="row" style="gap:12px">
          <div><label>Grupo</label><input id="gb-grupo" class="input-field" placeholder="1A"></div>
        </div>
        <div class="row" style="gap:12px;margin-top:8px">
          <div style="flex:1"><label>Alumnos (uno por línea)</label><textarea id="gb-alumnos" rows="6" class="input-field" placeholder="María L.
Gabriel R."></textarea></div>
          <div style="flex:1"><label>Actividades (Título,Porcentaje, Criterio/Saber opcional)</label><textarea id="gb-actividades" rows="6" class="input-field" placeholder="Proyecto Agua,30,Competencia cívica
Resolución de problemas,70,Pensamiento matemático"></textarea></div>
        </div>
        <button id="gb-generar" class="btn btn-primary" style="margin-top:8px">Generar tabla</button>
        <div id="gb-actions" style="display:none;gap:8px;margin:10px 0"></div>
        <div id="gb-tabla" style="overflow:auto"></div>
      </div>

      <!-- Rúbricas -->
      <div id="view-rubricas" class="content-view card hidden">
        <h2>Rúbricas (Auto/Co-evaluación NEM)</h2>
        <div class="row" style="gap:12px">
          <div><label>Grupo</label><input id="rb-grupo" class="input-field" placeholder="1A"></div>
          <div style="flex:1"><label>Nombre</label><input id="rb-nombre" class="input-field" placeholder="Rúbrica Pensamiento crítico"></div>
        </div>
        <div class="row" style="gap:12px;margin-top:8px">
          <div style="flex:1"><label>Criterios (uno por línea)</label><textarea id="rb-criterios" rows="6" class="input-field" placeholder="Argumenta con evidencia
Colabora con respeto"></textarea></div>
          <div style="flex:1"><label>Niveles (separados por coma)</label><textarea id="rb-niveles" rows="6" class="input-field" placeholder="Inicial,En proceso,Satisfactorio,Destacado"></textarea></div>
        </div>
        <button id="rb-guardar" class="btn btn-primary" style="margin-top:8px">Guardar rúbrica</button>
        <ol id="rb-list" style="margin-top:10px"></ol>
      </div>

      <!-- INSIGNIAS -->
      <div id="view-insignias" class="content-view card hidden">
        <h2>Insignias Digitales (Reconocimientos MX)</h2>
        <div class="row" style="gap:12px">
          <div><label>Grupo</label><input id="bz-grupo" class="input-field" placeholder="1A"></div>
          <div><label>Nombre de la insignia</label><input id="bz-nombre" class="input-field" placeholder="Líder comunitario"></div>
          <div><label>Puntos</label><input id="bz-puntos" type="number" value="5" class="input-field"></div>
        </div>
        <button id="bz-asignar" class="btn btn-primary" style="margin-top:8px">Asignar a alumno.</button>
        <ol id="bz-list" style="margin-top:10px"></ol>
      </div>

      <!-- DIARIO -->
      <div id="view-diario" class="content-view card hidden">
        <h2>Diario y Planeador NEM</h2>
        <div class="row" style="gap:12px">
          <div><label>Fecha</label><input id="dj-fecha" class="input-field" type="date"></div>
          <div><label>Grupo</label><input id="dj-grupo" class="input-field" placeholder="1A"></div>
        </div>
        <div class="row" style="gap:12px;margin-top:8px">
          <div style="flex:1"><label>Nota / Evidencia</label><textarea id="dj-nota" rows="5" class="input-field" placeholder="Registro de clase, actividad, acuerdos de convivencia."></textarea></div>
          <div style="flex:1"><label>Adjunto (URL)</label><input id="dj-adjunto" class="input-field" placeholder="https://."></div>
        </div>
        <button id="dj-guardar" class="btn btn-primary" style="margin-top:8px">Guardar entrada</button>
        <ol id="dj-list" style="margin-top:10px"></ol>
      </div>
    </main>
  </div>

  <!-- LÓGICA PRINCIPAL Y módulos -->
  <script type="module">
// === Navegación limpia + splash seguro ===

// Helpers de Storage (opcionales)
const LS = {
  get:(k,f)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? f } catch{ return f } },
  set:(k,v)=> localStorage.setItem(k, JSON.stringify(v)),
};

// Vistas y menú
const views = document.querySelectorAll('.content-view');
const navLinks = document.querySelectorAll('#app-sidebar nav a');

function showView(viewId){
  const targetId = iew-;
  let found = false;

  views.forEach(v => {
    const on = v.id === targetId;
    v.classList.toggle('hidden', !on);
    if(on) found = true;
  });

  navLinks.forEach(a => {
    const active = a.dataset.view === viewId;
    a.classList.toggle('active', active);
    if(active) a.setAttribute('aria-current','page'); else a.removeAttribute('aria-current');
  });

  if(found) LS.set('atemix.last_view', viewId);
}

function wireNav(){
  navLinks.forEach(a => a.addEventListener('click', (e) => {
    e.preventDefault();
    const view = a.dataset.view || 'onboarding';
    showView(view);
  }));
}

async function initModules(){
  const mods = [
    ['./modules/onboarding.js','initOnboarding'],
    ['./modules/catalogo.js','initCatalogo'],
    ['./modules/planeacion.js','initPlaneacion'],
    ['./modules/gradebook.js','initGradebook'],
    ['./modules/rubricas.js','initRubricas'],
    ['./modules/insignias.js','initInsignias'],
    ['./modules/diario.js','initDiario'],
  ];
  for (const [path, fn] of mods){
    try{ const m = await import(path); if(typeof m[fn] === 'function') m[fn](); }catch(_){ /* noop */ }
  }
}

// Splash y arranque
function boot(){
  const mainApp = document.getElementById('main-app');
  const splash  = document.getElementById('splash-screen');

  const reveal = () => {
    splash?.classList.add('splash-hide');
    mainApp?.classList.add('visible');
    mainApp?.classList.remove('hidden');
  };
  setTimeout(reveal, 900);

  wireNav();

  const last = LS.get('atemix.last_view', 'onboarding');
  views.forEach(v => v.classList.add('hidden'));
  // valida que exista la vista, si no, onboarding
  const candidate = Array.from(views).some(v=>v.id===iew-) ? last : 'onboarding';
  showView(candidate);

  // Inicializar módulos funcionales
  initModules();
}

if(document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', boot);
}else{ boot(); }
</script>
</body>
</html>



